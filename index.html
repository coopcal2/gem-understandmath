<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understand Your Math â€” No Login Required</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- MathJax Configuration -->
    <script>
      window.MathJax = {
        tex: { inlineMath: [['\\(', '\\)']], displayMath: [['\\[', '\\]']] },
        svg: { fontCache: 'global' }
      };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #F7F8FA; /* Light gray background */
        }
        /* Custom scrollbar for a cleaner look */
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        .chat-container::-webkit-scrollbar-track {
            background: transparent;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 3px;
        }
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #cbd5e1;
        }
        /* Fade-in animation for new messages */
        .message-card {
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Message alignment helpers */
        .user-msg-container {
            display: flex;
            justify-content: flex-end;
        }
        .ai-msg-container {
            display: flex;
            justify-content: flex-start;
        }
    </style>
</head>
<body class="text-slate-900 flex flex-col h-screen p-4">

    <!-- Main Content Wrapper -->
    <div class="w-full max-w-3xl mx-auto flex flex-col h-full">

        <!-- Header / Branding -->
        <header class="text-center pt-6 pb-8">
            <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight text-slate-900 mb-4">
                Stop <s class="text-red-500/80">plagiarizing</s>.
                <br>
                Start understanding.
            </h1>
            <p class="text-md text-slate-600">
                ðŸ§  No login. No sign-up. Just understanding.
            </p>
        </header>

        <!-- Chat Interface -->
        <main id="chat-container" class="chat-container flex-1 overflow-y-auto space-y-6 p-4 bg-white border border-slate-200 rounded-xl shadow-sm">
            <!-- Initial Message -->
            <div class="ai-msg-container">
                <div class="message-card max-w-xl bg-white p-4 rounded-xl">
                    <p class="font-semibold text-blue-600 mb-2">Math AI Tutor</p>
                    <p>Hello! Let's solve some math problems together. Type your problem below to get started.</p>
                </div>
            </div>
            <!-- New messages will be appended here -->
        </main>
        
        <!-- Floating Prompt Input -->
        <footer class="pt-4 pb-2">
            <form id="prompt-form" class="relative">
                <div class="bg-white rounded-xl shadow-md border border-slate-200">
                    <input type="text" id="prompt-input" class="w-full rounded-xl bg-transparent py-4 pl-5 pr-14 text-base text-slate-900 placeholder:text-slate-400 focus:outline-none" placeholder="Type a math problem..." autocomplete="off">
                    <button type="submit" class="absolute inset-y-0 right-0 flex items-center justify-center w-14 h-full text-slate-400 hover:text-blue-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0.0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
            </form>
            <!-- Small Footer Text -->
            <p class="text-center text-xs text-slate-400 mt-3">
                Â© 2025 Understand Your Math â€” Made to help you understand, not just memorize.
            </p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatContainer = document.getElementById('chat-container');
            const promptForm = document.getElementById('prompt-form');
            const promptInput = document.getElementById('prompt-input');

            // --- API Configuration ---
            const OPENROUTER_API_KEY = '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';
            
            const chatHistory = [
                { 
                    role: 'system', 
                    content: 'You are a Socratic math tutor. Your primary goal is to help the user understand how to solve the problem on their own, not to give them the answer. When a user presents a math problem, do not provide the final answer or the full step-by-step solution at once. Instead, start by asking a guiding question to get them to think about the first step. For example, you could ask "What\'s the first thing you think we should do here?" or "What does that term mean?". Explain concepts one small piece at time and encourage them to try the next step themselves. Only provide the next step when they ask for it or if they are stuck. Use LaTeX for all mathematical expressions, enclosing inline math with \\( ... \\) and display math with \\[ ... \\].' 
                }
            ];

            /**
             * Appends a new message to the chat interface.
             * @param {string} role - The role of the sender ('user' or 'assistant').
             * @param {string} content - The message content.
             */
            function appendMessage(role, content) {
                const isUser = role === 'user';
                const messageContainer = document.createElement('div');
                messageContainer.className = isUser ? 'user-msg-container' : 'ai-msg-container';
                
                const bubble = document.createElement('div');
                bubble.className = `message-card max-w-xl p-4 rounded-xl shadow-sm ${isUser ? 'bg-blue-100 text-blue-900' : 'bg-white'}`;
                
                // Add border to AI messages for clarity, but not the user's
                if (!isUser) {
                    bubble.classList.add('border', 'border-slate-200');
                }

                bubble.innerHTML = content.replace(/\n/g, '<br>');

                messageContainer.appendChild(bubble);
                chatContainer.appendChild(messageContainer);
                
                chatContainer.scrollTop = chatContainer.scrollHeight;

                if (!isUser && window.MathJax) {
                    MathJax.typesetPromise([bubble]).catch((err) => console.log('MathJax error:', err));
                }
            }
            
            /**
             * Shows a "Thinking..." indicator in the chat.
             * @returns {HTMLElement} The indicator element, so it can be removed later.
             */
            function showThinkingIndicator() {
                const thinkingContainer = document.createElement('div');
                thinkingContainer.className = 'ai-msg-container';
                thinkingContainer.id = 'thinking-indicator';
                thinkingContainer.innerHTML = `<div class="message-card max-w-xl bg-white p-4 rounded-xl shadow-sm border border-slate-200"><div class="flex items-center gap-3 text-slate-500"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-slate-400"></div><span>The AI is thinking...</span></div></div>`;
                
                chatContainer.appendChild(thinkingContainer);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return thinkingContainer;
            }

            /**
             * Sends the user's prompt to the OpenRouter API.
             */
            async function sendPrompt() {
                const userText = promptInput.value.trim();
                if (!userText) return;

                appendMessage('user', userText);
                promptInput.value = ''; // Clear the input
                
                chatHistory.push({ role: 'user', content: userText });

                const thinkingIndicator = showThinkingIndicator();
                
                try {
                    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: chatHistory
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const data = await response.json();
                    const aiReply = data?.choices?.[0]?.message?.content;

                    thinkingIndicator.remove(); // Remove "Thinking..."

                    if (aiReply) {
                        appendMessage('assistant', aiReply);
                        chatHistory.push({ role: 'assistant', content: aiReply });
                    } else {
                        appendMessage('assistant', 'Sorry, I received an empty response. Please try again.');
                    }

                } catch (error) {
                    console.error('Error connecting to AI:', error);
                    thinkingIndicator.remove(); // Also remove on error
                    appendMessage('assistant', 'Sorry, there was an error connecting to the AI. Please check your connection and API key.');
                }
            }

            // --- Event Listeners ---
            promptForm.addEventListener('submit', (e) => {
                e.preventDefault();
                sendPrompt();
            });
        });
    </script>
</body>
</html>

